<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Happy Valentine's Day!</title>
    <style>
        body { background-color: #fff0f3; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; touch-action: manipulation; }
        .card { background: white; padding: 20px; border-radius: 30px; box-shadow: 0 15px 40px rgba(255, 75, 110, 0.2); text-align: center; width: 90%; max-width: 360px; margin: 20px auto; }
        h2, h3 { color: #ff4d6d; margin: 10px 0; }
        .menu-btn { background-color: #ff4d6d; color: white; border: none; padding: 15px; border-radius: 25px; margin: 10px auto; cursor: pointer; font-size: 16px; width: 100%; display: block; transition: 0.3s; font-weight: bold; }
        .menu-btn:disabled { background-color: #ffb3c1; cursor: not-allowed; opacity: 0.7; }
        
        .grid-container { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 8px; 
            margin-top: 15px; 
            min-height: 250px; 
        }

        .tile { 
            aspect-ratio: 1/1; 
            background: #ff4d6d; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 28px; 
            color: transparent; /* é è¨­éš±è—æ–‡å­— */
            border-radius: 12px; 
            cursor: pointer; 
            transition: background-color 0.2s, transform 0.2s;
            user-select: none; 
            -webkit-user-select: none; 
            -webkit-tap-highlight-color: transparent;
        }

        /* ç§»é™¤ 3D æ—‹è½‰ï¼Œæ”¹ç”¨æ›´ç©©å®šçš„æ¨£å¼åˆ‡æ›é˜²æ­¢æ‰‹æ©Ÿç™½å± */
        .tile.flipped { 
            color: #ffffff !important; 
            background-color: #ff85a1 !important; 
            transform: scale(1.05); /* è¼•å¾®æ”¾å¤§å–ä»£ç¿»è½‰ï¼Œç¢ºä¿æ‰‹æ©Ÿç›¸å®¹æ€§ */
        }

        .rps-btn { font-size: 30px; margin: 5px; background: white; border: 2px solid #ffb6c1; border-radius: 50%; width: 60px; height: 60px; cursor: pointer; }
        input { padding: 12px; border-radius: 15px; border: 2px solid #ffb3c1; text-align: center; width: 100%; font-size: 16px; outline: none; margin-bottom: 10px; box-sizing: border-box; }
        .back-btn { margin-top: 15px; background: #ced4da; color: white; border: none; padding: 8px 20px; border-radius: 15px; cursor: pointer; }
        canvas { border: 3px solid #ffb3c1; border-radius: 20px; background: #fff; display: block; margin: 0 auto; max-width: 100%; height: auto; }
    </style>
</head>
<body>

    <div id="login-box" class="card">
        <h2>â¤ï¸ Valentine's Day â¤ï¸</h2>
        <p>Enter our special date </p>
        <input type="text" id="password" placeholder="YYYYMMDD">
        <button class="menu-btn" onclick="unlock()">Start</button>
    </div>

    <div id="game-menu" class="card" style="display:none;">
        <h3>Adventure Map</h3>
        <button id="btn-1" class="menu-btn" onclick="showScreen('memory-game'); setTimeout(startMemoryGame, 100);">Level 1: Memory Game</button>
        <button id="btn-2" class="menu-btn" disabled onclick="showScreen('rps-game')">Level 2: Rock Paper Scissors</button>
        <button id="btn-3" class="menu-btn" disabled onclick="showScreen('flappy-game'); initFlappy();">Level 3: Valentine Bird</button>
        <button id="btn-4" class="menu-btn" disabled onclick="showScreen('catch-game'); startCatchGame();">Level 4: Bunny & Cake</button>
        <button id="btn-final" class="menu-btn" style="display:none; background: #ff0054;" onclick="showScreen('final-message')">ğŸ Final Message</button>
    </div>

    <div id="memory-game" class="card" style="display:none;">
        <h3>Level 1: Memory</h3>
        <div id="grid" class="grid-container"></div>
        <button class="back-btn" onclick="backToMenu()">Back</button>
    </div>

    <div id="rps-game" class="card" style="display:none;">
        <h3>Level 2: RPS</h3>
        <p>Wins: <span id="win-count">0</span>/3</p>
        <div id="rps-display" style="font-size: 50px; margin: 15px;">â“</div>
        <button class="rps-btn" onclick="playRPS('âœŠ')">âœŠ</button>
        <button class="rps-btn" onclick="playRPS('âœŒï¸')">âœŒï¸</button>
        <button class="rps-btn" onclick="playRPS('ğŸ–ï¸')">ğŸ–ï¸</button>
        <br><button class="back-btn" onclick="backToMenu()">Back</button>
    </div>

    <div id="flappy-game" class="card" style="display:none;">
        <h3>Level 3: Valentine Bird</h3>
        <p>Score: <span id="flappy-score">0</span> / 5</p>
        <canvas id="flappyCanvas" width="300" height="300"></canvas>
        <p id="flappy-hint" style="color: #ff4d6d; font-weight: bold; margin-top: 10px;">Tap to Jump!</p>
        <button class="back-btn" onclick="backToMenu()">Back</button>
    </div>

    <div id="catch-game" class="card" style="display:none;">
        <h3>Level 4: Tiny Bunny Catch ğŸ°</h3>
        <p>Score: <span id="catch-score">0</span> / 15</p>
        <p style="font-size: 14px; color: #ff4d6d; margin-bottom: 10px; font-weight: bold;">Slide Bunny to catch cakes! ğŸ‚</p>
        <canvas id="catchCanvas" width="300" height="350"></canvas>
        <button class="back-btn" onclick="backToMenu()">Back</button>
    </div>

    <div id="final-message" class="card" style="display:none;">
        <h2 style="color: #ff0054;">For Hsiu â¤ï¸</h2>
        <p style="text-align: left; line-height: 1.6;">ï¼â¤ï¸</p>
        <button class="menu-btn" onclick="location.reload()">Replay</button>
    </div>

    <script>
        let currentProgress = 1;
        let gameLoopId;
        let isFlappyRunning = false;
        let rpsWins = 0;

        function unlock() {
            if (document.getElementById('password').value === '20260214') showScreen('game-menu');
            else alert('Wrong date!!');
        }

        function showScreen(id) {
            document.querySelectorAll('.card').forEach(c => c.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            window.scrollTo(0, 0);
            updateMenuButtons();
        }

        function backToMenu() {
            cancelAnimationFrame(gameLoopId);
            isFlappyRunning = false;
            showScreen('game-menu');
        }

        function updateMenuButtons() {
            if (currentProgress >= 2) document.getElementById('btn-2').disabled = false;
            if (currentProgress >= 3) document.getElementById('btn-3').disabled = false;
            if (currentProgress >= 4) document.getElementById('btn-4').disabled = false;
            if (currentProgress >= 5) document.getElementById('btn-final').style.display = 'block';
        }

        // --- Level 1 ç©©å®šç‰ˆ ---
        function startMemoryGame() {
            const grid = document.getElementById('grid');
            grid.innerHTML = ''; 
            let matches = 0;
            let flipped = [];
            const icons = ['â¤ï¸', 'ğŸ’–', 'ğŸŒ¹', 'ğŸ«', 'ğŸ’', 'ğŸ’Œ'];
            let cards = [...icons, ...icons].sort(() => Math.random() - 0.5);

            cards.forEach(icon => {
                const tile = document.createElement('div');
                tile.className = 'tile';
                tile.dataset.icon = icon;
                
                const handleFlip = function(e) {
                    if (e && e.type === 'touchend') e.preventDefault();
                    if (tile.classList.contains('flipped') || flipped.length === 2) return;
                    
                    // å¼·åˆ¶è¨­å®šæ¨£å¼ï¼Œä¸ä½¿ç”¨è¤‡é›œå‹•ç•«
                    tile.classList.add('flipped');
                    tile.textContent = tile.dataset.icon;
                    flipped.push(tile);

                    if (flipped.length === 2) {
                        if (flipped[0].dataset.icon === flipped[1].dataset.icon) {
                            matches++;
                            flipped = [];
                            if (matches === 6) {
                                currentProgress = 2;
                                setTimeout(() => { alert("Level 1 Clear!"); showScreen('rps-game'); }, 500);
                            }
                        } else {
                            setTimeout(() => {
                                flipped.forEach(t => {
                                    t.classList.remove('flipped');
                                    t.textContent = '';
                                });
                                flipped = [];
                            }, 600);
                        }
                    }
                };

                tile.onclick = handleFlip;
                tile.ontouchend = handleFlip;
                grid.appendChild(tile);
            });
        }

        function playRPS(user) {
            const pc = ['âœŠ', 'âœŒï¸', 'ğŸ–ï¸'][Math.floor(Math.random()*3)];
            document.getElementById('rps-display').innerText = `${user} vs ${pc}`;
            if ((user==='âœŠ'&&pc==='âœŒï¸')||(user==='âœŒï¸'&&pc==='ğŸ–ï¸')||(user==='ğŸ–ï¸'&&pc==='âœŠ')) {
                rpsWins++; document.getElementById('win-count').innerText = rpsWins;
                if(rpsWins >= 3) { currentProgress = 3; setTimeout(() => { alert("Level 2 Clear!"); showScreen('flappy-game'); initFlappy(); }, 300); }
            }
        }

        function initFlappy() {
            isFlappyRunning = false;
            const canvas = document.getElementById('flappyCanvas'); const ctx = canvas.getContext('2d');
            ctx.fillStyle = "#e0f7fa"; ctx.fillRect(0, 0, 300, 300);
            drawBird(ctx, 50, 150);
            canvas.onclick = (e) => { e.preventDefault(); if(!isFlappyRunning) startFlappyGame(); };
        }

        function drawBird(ctx, x, y) {
            ctx.fillStyle = "#6d6d6d"; ctx.beginPath(); ctx.arc(x, y - 12, 5, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = "#4a4a4a"; ctx.beginPath(); ctx.ellipse(x - 8, y + 2, 12, 6, Math.PI / 6, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(x, y, 14, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = "black"; ctx.beginPath(); ctx.arc(x + 4, y - 2, 1.5, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = "#f1c40f"; ctx.beginPath(); ctx.moveTo(x + 2, y + 1); ctx.quadraticCurveTo(x + 8, y + 8, x + 2, y + 15); ctx.lineTo(x - 1, y + 8); ctx.fill();
        }

        function startFlappyGame() {
            isFlappyRunning = true; const canvas = document.getElementById('flappyCanvas'); const ctx = canvas.getContext('2d');
            let bird = { x: 50, y: 150, v: 0, g: 0.18, score: 0 }; let pipes = [];
            canvas.onclick = (e) => { e.preventDefault(); bird.v = -3.8; };
            function run() {
                if (!isFlappyRunning) return;
                ctx.fillStyle = "#e0f7fa"; ctx.fillRect(0, 0, 300, 300);
                bird.v += bird.g; bird.y += bird.v; drawBird(ctx, bird.x, bird.y);
                if (pipes.length === 0 || pipes[pipes.length - 1].x < 140) pipes.push({ x: 300, y: Math.random() * 120 + 60, passed: false });
                pipes.forEach((p) => {
                    p.x -= 1.8; ctx.fillStyle = "#ffb6c1"; ctx.fillRect(p.x, 0, 35, p.y); ctx.fillRect(p.x, p.y + 110, 35, 300);
                    if (bird.y < 0 || bird.y > 300 || (bird.x + 6 > p.x && bird.x - 6 < p.x + 35 && (bird.y - 6 < p.y || bird.y + 6 > p.y + 110))) {
                        isFlappyRunning = false; alert("Oops! Try again."); initFlappy();
                    }
                    if (!p.passed && p.x < bird.x) { p.passed = true; bird.score++; document.getElementById('flappy-score').innerText = bird.score; }
                });
                if (bird.score >= 5) { isFlappyRunning = false; currentProgress = 4; setTimeout(() => { alert("Level 3 Clear!"); showScreen('catch-game'); startCatchGame(); }, 300); }
                else { pipes = pipes.filter(p => p.x > -40); gameLoopId = requestAnimationFrame(run); }
            }
            run();
        }

        function startCatchGame() {
            const canvas = document.getElementById('catchCanvas'); const ctx = canvas.getContext('2d');
            let bunnyX = 150; let score = 0; let cakes = []; let speed = 3.2;
            document.getElementById('catch-score').innerText = score;
            const updateBunny = (clientX) => {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                bunnyX = (clientX - rect.left) * scaleX;
            };
            canvas.onmousemove = (e) => updateBunny(e.clientX);
            canvas.ontouchmove = (e) => { updateBunny(e.touches[0].clientX); e.preventDefault(); };

            function drawJellycatBunny(x) {
                const y = 320;
                ctx.fillStyle = "#e5e5e5";
                ctx.beginPath(); ctx.ellipse(x - 10, y - 8, 5, 18, 0.25, 0, Math.PI * 2); ctx.fill(); 
                ctx.beginPath(); ctx.ellipse(x + 10, y - 8, 5, 18, -0.25, 0, Math.PI * 2); ctx.fill();
                ctx.fillStyle = "#f0f0f0";
                ctx.beginPath(); ctx.arc(x, y, 14, 0, Math.PI * 2); ctx.fill();
                ctx.fillStyle = "black";
                ctx.beginPath(); ctx.arc(x - 4, y - 1, 1.2, 0, Math.PI * 2); ctx.fill();
                ctx.beginPath(); ctx.arc(x + 4, y - 1, 1.2, 0, Math.PI * 2); ctx.fill();
                ctx.fillStyle = "#ffb6c1";
                ctx.beginPath(); ctx.arc(x, y + 2, 1.5, 0, Math.PI * 2); ctx.fill();
                ctx.fillStyle = "#f0f0f0";
                ctx.beginPath(); ctx.arc(x - 7, y + 12, 4, 0, Math.PI * 2); ctx.fill();
                ctx.beginPath(); ctx.arc(x + 7, y + 12, 4, 0, Math.PI * 2); ctx.fill();
            }

            function runCatch() {
                ctx.clearRect(0, 0, 300, 350); drawJellycatBunny(bunnyX);
                if (Math.random() < 0.07) {
                    const isTrap = Math.random() < 0.25;
                    cakes.push({ x: Math.random() * 260 + 20, y: -20, type: isTrap ? 'ğŸ’£' : 'ğŸ‚' });
                }
                cakes.forEach((c, i) => {
                    c.y += speed; ctx.font = "24px Arial"; ctx.fillText(c.type, c.x, c.y);
                    if (c.y > 300 && c.y < 340 && Math.abs(c.x - bunnyX) < 18) {
                        if (c.type === 'ğŸ’£') { alert("Boom!"); score = 0; speed = 3.2; cakes = []; }
                        else { score++; speed += 0.12; }
                        cakes.splice(i, 1); document.getElementById('catch-score').innerText = score;
                    }
                });
                if (score >= 15) { currentProgress = 5; cancelAnimationFrame(gameLoopId); setTimeout(() => { alert("Congratulations! â¤ï¸"); showScreen('final-message'); }, 300); }
                else { cakes = cakes.filter(c => c.y < 360); gameLoopId = requestAnimationFrame(runCatch); }
            }
            runCatch();
        }
    </script>
</body>
</html>
